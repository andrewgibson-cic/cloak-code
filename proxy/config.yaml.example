# Universal API Credential Injector - Configuration File
#
# This file defines the strategies and rules for credential injection.
# Copy this to config.yaml and fill in your real credentials.

# Strategy Definitions
# Each strategy defines how to authenticate with a specific service or protocol
strategies:
  # AWS SigV4 Strategy for Production
  - name: aws-prod
    type: aws_sigv4
    config:
      # Credentials can be direct values or environment variable names
      access_key_id: AWS_ACCESS_KEY_ID        # Read from env var
      secret_access_key: AWS_SECRET_ACCESS_KEY # Read from env var
      session_token: AWS_SESSION_TOKEN         # Optional, for temporary creds
      region: us-east-1                        # Default region
      allowed_hosts:
        - "*.amazonaws.com"
        - "*.amazonaws.com.cn"
  
  # AWS SigV4 Strategy for Development (different credentials)
  - name: aws-dev
    type: aws_sigv4
    config:
      access_key_id: AWS_DEV_ACCESS_KEY_ID
      secret_access_key: AWS_DEV_SECRET_ACCESS_KEY
      region: us-west-2
      allowed_hosts:
        - "*.amazonaws.com"
  
  # Stripe API Strategy
  - name: stripe-live
    type: stripe  # Specialized Bearer strategy
    config:
      token: STRIPE_SECRET_KEY  # Read from env var
  
  # GitHub API Strategy
  - name: github-personal
    type: github  # Specialized Bearer strategy
    config:
      token: GITHUB_TOKEN  # Read from env var
  
  # OpenAI API Strategy
  - name: openai
    type: openai  # Specialized Bearer strategy
    config:
      token: OPENAI_API_KEY  # Read from env var
  
  # Generic Bearer Token Strategy Example
  - name: custom-api
    type: bearer
    config:
      token: CUSTOM_API_TOKEN
      dummy_pattern: "DUMMY_CUSTOM_TOKEN"
      allowed_hosts:
        - "api.example.com"
        - "*.example.com"

# Injection Rules
# Rules define when to apply each strategy based on request characteristics
rules:
  # AWS Production Rule
  - name: aws-prod-injection
    # Match requests to AWS endpoints
    domain_regex: ".*\\.amazonaws\\.com$"
    # With dummy AWS credentials in headers
    trigger_header_regex: "AKIA[0-9A-Z]{16}DUMMY"
    # Apply the aws-prod strategy
    strategy: aws-prod
    priority: 100
  
  # AWS Development Rule (higher priority for specific dev pattern)
  - name: aws-dev-injection
    domain_regex: ".*\\.amazonaws\\.com$"
    trigger_header_regex: "AKIA00000000DEVKEY"
    strategy: aws-dev
    priority: 110  # Higher priority = evaluated first
  
  # Stripe Rule
  - name: stripe-injection
    domain_regex: "^(api\\.)?stripe\\.com$"
    trigger_header_regex: "sk_(test|live)_00000000"
    strategy: stripe-live
    priority: 100
  
  # GitHub Rule
  - name: github-injection
    domain_regex: "^(api\\.)?github\\.com$"
    trigger_header_regex: "(ghp_[a-zA-Z0-9]{36}DUMMY|DUMMY_GITHUB_TOKEN)"
    strategy: github-personal
    priority: 100
  
  # OpenAI Rule
  - name: openai-injection
    domain_regex: "^api\\.openai\\.com$"
    trigger_header_regex: "(sk-proj-[a-zA-Z0-9]{32}DUMMY|DUMMY_OPENAI_KEY)"
    strategy: openai
    priority: 100

# Global Settings
settings:
  # Logging configuration
  log_level: INFO  # DEBUG, INFO, WARNING, ERROR
  log_format: json  # json or text
  
  # Security settings
  fail_mode: closed  # closed (drop on error) or open (pass through on error)
  
  # Performance settings
  max_body_size_mb: 100  # Maximum body size to process (larger uses streaming)
  
  # Telemetry blocking (optional)
  block_telemetry: true
  telemetry_domains:
    - "telemetry.anthropic.com"
    - "sentry.io"
    - "*.sentry.io"
    - "analytics.google.com"
    - "*.segment.com"
    - "*.mixpanel.com"
    - "*.amplitude.com"
